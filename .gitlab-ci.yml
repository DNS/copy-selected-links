image: node:14.15.5-alpine

cache:
  paths:
    - .pnpm-store/

ci:
  variables:
    # can't cache outside project dir, so override the default to cache the store
    npm_config_store_dir: .pnpm-store
  script:
    # necessary with alpine's minimal image
    - apk add --no-cache git make python util-linux
    # pnpm does not come bundled
    - npm install -g pnpm
    - pnpm install --frozen-lockfile
    - pnpm build
    - pnpx git-is-clean
    # keep ci cache lean
    - pnpm store prune
